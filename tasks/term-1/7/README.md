# Лабораторная работа 7: Параллельное умножение матриц

## Описание
Реализация параллельного умножения матриц с использованием многопоточности на Java. Программа использует `ExecutorService` для управления потоками и сравнивает производительность с однопоточной версией.

## Реализация

### Основные методы
1. `multiply(double[][] A, double[][] B)` - однопоточное умножение матриц
2. `multiplyParallel(double[][] A, double[][] B)` - параллельное умножение с автоматическим выбором количества потоков
3. `multiplyParallel(double[][] A, double[][] B, int threadCount)` - параллельное умножение с заданным количеством потоков

### Стратегия параллелизации
- Матрица делится по строкам между потоками
- Каждый поток вычисляет свой блок строк результата
- Используется `Executors.newFixedThreadPool()` для создания пула потоков
- Работа завершается через `awaitTermination()` для гарантии завершения всех вычислений

## Подбор оптимального количества потоков

### Методология тестирования
1. Тестирование проводилось на процессоре с **4 физическими ядрами**
2. Использовались матрицы размеров: **500×500** и **1000×1000**
3. Для каждого теста выполнялось **5 измерений** с последующим усреднением
4. Измерялось время выполнения для: 2, 4, 8 потоков

### Результаты тестирования

#### Матрица 500×500
| Количество потоков | Время (мс) | Ускорение | Эффективность |
|-------------------|------------|-----------|---------------|
| 1 (однопоточный)  | 1516       | 1.00x     | 100%          |
| 2                 | 798        | 1.90x     | 95%           |
| 4                 | 559        | 2.71x     | 68%           |
| 8                 | 498        | 3.04x     | 38%           |

#### Матрица 1000×1000
| Количество потоков | Время (мс) | Ускорение | Эффективность |
|-------------------|------------|-----------|---------------|
| 1 (однопоточный)  | 19169      | 1.00x     | 100%          |
| 2                 | 10826      | 1.77x     | 89%           |
| 4                 | 5307       | 3.61x     | 90%           |
| 8                 | 5300       | 3.62x     | 45%           |

### Анализ результатов

1. **Для матрицы 500×500**:
   - Максимальное ускорение достигается при **8 потоках** (3.04x)
   - Однако эффективность использования потоков падает до 38%
   - Разница между 4 и 8 потоками составляет всего 61 мс (11%)

2. **Для матрицы 1000×1000**:
   - Максимальное ускорение при **8 потоках** (3.62x)
   - Но разница между 4 и 8 потоками практически отсутствует (7 мс)
   - Эффективность при 4 потоках составляет 90%, при 8 - 45%

### Выводы и выбор оптимального количества потоков

**Оптимальное количество потоков: 4**

#### Обоснование:
1. **Соответствие архитектуре процессора**: Процессор имеет 4 физических ядра
2. **Баланс производительности и эффективности**: 
   - При 4 потоках достигается 90% эффективности для больших матриц
   - При 8 потоках эффективность падает вдвое (45%) при незначительном приросте скорости
3. **Стабильность результатов**: Для обеих тестовых матриц 4 потока показывают стабильно хорошие результаты
4. **Накладные расходы**: Создание большего количества потоков чем физических ядер увеличивает накладные расходы на переключение контекста

#### Дополнительные наблюдения:
- Для матриц меньшего размера (<300×300) параллельное вычисление может быть менее эффективным из-за накладных расходов на создание потоков
- Эффективность параллелизации растет с увеличением размера матрицы
- Для очень больших матриц (>2000×2000) можно рассматривать увеличение количества потоков до 8

## Особенности реализации

### Выбор ExecutorService вместо Thread
В реализации использован `ExecutorService`, а не наследование от `Thread`, потому что:
1. `ExecutorService` предоставляет более высокоуровневый API для управления потоками
2. Пул потоков позволяет переиспользовать потоки, уменьшая накладные расходы
3. Легче контролировать завершение всех потоков через `awaitTermination()`

### Алгоритм распределения работы
Работа распределяется по строкам матрицы:
- Каждый поток получает примерно равное количество строк
- Остаток строк равномерно распределяется между первыми потоками
- Потоки работают независимо, не требуя синхронизации

## Запуск программы
```bash
javac MatrixMultPar.java
java MatrixMultPar
