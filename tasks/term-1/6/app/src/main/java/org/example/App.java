/*
 * This source file was generated by the Gradle 'init' task
 */
package org.example;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Arrays;
import java.util.Scanner;

public class App {
    public String getGreeting() {
        return "Hello World!";
    }

    public class Point {
        public int x, y;
        public Point(int x, int y) {
            this.x = x;
            this.y = y;
        }
        public Point(String x, String y) {
            this.x = Integer.parseInt(x);
            this.y = Integer.parseInt(y);
        }
    }

    public double getDistance(Point a, Point b) {
    double dx = a.x - b.x;
    double dy = a.y - b.y;
    return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
    }

    public String[][] readFile(String path) throws IOException{
        int size = 0;
        try (BufferedReader counter = new BufferedReader(new FileReader(path))){
            while (counter.readLine() != null) {
                size++;
            }
        }
        String[] xs = new String[size];
        String[] ys = new String[size];
        String[] classes = new String[size];
        
        try (BufferedReader br = new BufferedReader(new FileReader(path))) {
            String line = br.readLine();
            int index = 0;
            while ((line = br.readLine()) != null && index < size) {
                int leftSpace = line.indexOf(' ');
                int rightSpace = line.lastIndexOf(' ');

                xs[index] = line.substring(0, leftSpace);
                ys[index] = line.substring(leftSpace + 1, rightSpace);
                classes[index] = line.substring(rightSpace + 1);

                index++;
            }
        }
        return new String[][]{xs,ys,classes};
    }

    public String predictClass(String[][] trainingSet, Point a){
        int setLen = trainingSet[0].length - 1;
        double[] distances = new double[setLen];

        for(int i = 0; i < setLen; i++){
            Point b = new Point(trainingSet[0][i], trainingSet[1][i]);
            distances[i] = getDistance(a, b);
        }

        String[] nearestClasses = new String[3];
        for(int i = 0; i < 3; i++){
            int nnIndex = 0;
            for(int j = 0; j < setLen; j++){
                if(distances[nnIndex] > distances[j])
                    nnIndex = j;
            }
            nearestClasses[i] = trainingSet[2][nnIndex];
            distances[nnIndex] = Integer.MAX_VALUE;
        }
        if(nearestClasses[1] == nearestClasses[0] || nearestClasses[1] == nearestClasses[2])
            return nearestClasses[1];
        else return nearestClasses[0]; // [0] == [2], or all classes are different and it's nearest one.
    }

    public void doAll(String[] args) throws IOException{
        Scanner scanner = new Scanner(System.in);
        String trainingSetPath = new String("src/main/training_set.txt");

        System.out.println("write x:");
        String x = scanner.nextLine(); 
        System.out.println("write y:");
        String y = scanner.nextLine(); 
        Point point = new Point(x, y);
        String result = predictClass(readFile(trainingSetPath), point);
        System.out.println("prediction: " + result);
    
        scanner.close();  
    }

    public static void main(String[] args){
        try {
        App app = new App();
        app.doAll(args);
        } catch (IOException e) {
        System.err.println("Error reading training data: " + e.getMessage());
        e.printStackTrace();
        }
    }
}
